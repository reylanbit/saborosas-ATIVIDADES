<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Atividade 29 - Carrinho Persistente com localStorage</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Arial, sans-serif; line-height: 1.6; margin: 0; background: #f9fafb; }
    .container { max-width: 1200px; margin: 0 auto; padding: 24px; }
    .layout { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; }
    @media (max-width: 860px) { .layout { grid-template-columns: 1fr; } }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; background: #fff; box-shadow: 0 6px 20px rgba(0,0,0,0.06); }
    .card h2 { margin: 0; padding: 14px 16px; border-bottom: 1px solid #e5e7eb; }
    .products { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; padding: 14px; }
    @media (max-width: 980px) { .products { grid-template-columns: repeat(2, 1fr); } }
    @media (max-width: 640px) { .products { grid-template-columns: 1fr; } }
    .pitem { border: 1px solid #e5e7eb; border-radius: 12px; padding: 12px; display: flex; flex-direction: column; gap: 8px; }
    .pname { font-weight: 800; color: #111827; }
    .pprice { color: #2563eb; font-weight: 900; }
    .btn { padding: 10px 14px; border-radius: 10px; border: 1px solid #e5e7eb; background: #f9fafb; cursor: pointer; font-weight: 700; }
    .btn.primary { background: #2563eb; border-color: #2563eb; color: #fff; }
    .cart { padding: 14px; }
    .row { display: grid; grid-template-columns: 1fr 90px 140px 70px; align-items: center; gap: 8px; padding: 8px 0; border-bottom: 1px dashed #e5e7eb; }
    .row:last-child { border-bottom: none; }
    .qty { display: inline-flex; gap: 6px; align-items: center; }
    .qty .btn { padding: 6px 10px; }
    .total { display: flex; justify-content: space-between; padding: 10px 0; font-weight: 900; }
    .muted { color: #6b7280; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Missão do Dia: Carrinho Persistente com localStorage</h1>
    <div class="layout">
      <div class="card">
        <h2>Produtos</h2>
        <div id="products" class="products"></div>
      </div>
      <div class="card">
        <h2>Seu Carrinho</h2>
        <div id="cart" class="cart"></div>
      </div>
    </div>
  </div>
  <script>
    var fmtBRL = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' });
    var products = [
      { id: 1, nome: 'Lavagem Express', preco: 69.90 },
      { id: 2, nome: 'Higienização Completa', preco: 149.00 },
      { id: 3, nome: 'Polimento', preco: 199.90 },
      { id: 4, nome: 'Vitrificação', preco: 399.90 },
      { id: 5, nome: 'Descontaminação', preco: 129.50 },
      { id: 6, nome: 'Detailing Premium', preco: 599.00 }
    ];
    var key = 'cart';
    function readCart() {
      try { var raw = localStorage.getItem(key); return raw ? JSON.parse(raw) : []; } catch (e) { return []; }
    }
    function writeCart(arr) {
      try { localStorage.setItem(key, JSON.stringify(arr)); } catch (e) {}
    }
    function findProduct(id) { for (var i = 0; i < products.length; i++) if (products[i].id === id) return products[i]; }
    function addItem(id) {
      var cart = readCart();
      var found = null;
      for (var i = 0; i < cart.length; i++) if (cart[i].id === id) { found = cart[i]; break; }
      if (found) { found.quantidade += 1; }
      else {
        var p = findProduct(id);
        cart.push({ id: id, nome: p.nome, preco: p.preco, quantidade: 1 });
      }
      writeCart(cart);
      renderCart();
    }
    function removeItem(id) {
      var cart = readCart();
      var idx = -1;
      for (var i = 0; i < cart.length; i++) if (cart[i].id === id) { idx = i; break; }
      if (idx !== -1) cart.splice(idx, 1);
      writeCart(cart);
      renderCart();
    }
    function changeQty(id, delta) {
      var cart = readCart();
      for (var i = 0; i < cart.length; i++) {
        if (cart[i].id === id) {
          cart[i].quantidade += delta;
          if (cart[i].quantidade <= 0) { cart.splice(i,1); }
          break;
        }
      }
      writeCart(cart);
      renderCart();
    }
    function clearCart() {
      writeCart([]);
      renderCart();
    }
    function subtotal(item) { return item.preco * item.quantidade; }
    function total(cart) { var s = 0; for (var i = 0; i < cart.length; i++) s += subtotal(cart[i]); return s; }
    function renderProducts() {
      var list = document.getElementById('products');
      list.innerHTML = products.map(function (p) {
        return '<div class="pitem">'
          + '<div class="pname">'+p.nome+'</div>'
          + '<div class="pprice">'+fmtBRL.format(p.preco)+'</div>'
          + '<button class="btn primary" data-id="'+p.id+'" data-action="add">Adicionar</button>'
          + '</div>';
      }).join('');
    }
    function renderCart() {
      var cartEl = document.getElementById('cart');
      var cart = readCart();
      if (!cart.length) {
        cartEl.innerHTML = '<div class="muted">Seu carrinho está vazio.</div>';
        return;
      }
      var rows = cart.map(function (it) {
        return '<div class="row" data-id="'+it.id+'">'
          + '<div>'+it.nome+'</div>'
          + '<div class="qty"><button class="btn" data-action="dec">-</button><span>'+it.quantidade+'</span><button class="btn" data-action="inc">+</button></div>'
          + '<div>'+fmtBRL.format(subtotal(it))+'</div>'
          + '<div><button class="btn" data-action="rm">Remover</button></div>'
          + '</div>';
      }).join('');
      var footer = '<div class="total"><span>Total</span><span>'+fmtBRL.format(total(cart))+'</span></div>'
        + '<button class="btn" id="clear">Limpar carrinho</button>';
      cartEl.innerHTML = rows + footer;
    }
    document.addEventListener('click', function (e) {
      var t = e.target;
      if (t.matches('#products .btn[data-action="add"]')) {
        var id = parseInt(t.getAttribute('data-id'), 10);
        addItem(id);
      } else if (t.matches('#cart .row .btn[data-action="inc"]')) {
        var id = parseInt(t.closest('.row').getAttribute('data-id'), 10);
        changeQty(id, +1);
      } else if (t.matches('#cart .row .btn[data-action="dec"]')) {
        var id = parseInt(t.closest('.row').getAttribute('data-id'), 10);
        changeQty(id, -1);
      } else if (t.matches('#cart .row .btn[data-action="rm"]')) {
        var id = parseInt(t.closest('.row').getAttribute('data-id'), 10);
        removeItem(id);
      } else if (t.matches('#clear')) {
        clearCart();
      }
    });
    renderProducts();
    renderCart();
  </script>
</body>
</html>
